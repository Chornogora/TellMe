<!DOCTYPE html>
<html>
<head>
	<title>Page 1</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
	<link href="resources/css/axure_rp_page.css" type="text/css" rel="stylesheet"/>
    <link href="data/styles.css" type="text/css" rel="stylesheet"/>
    <link href="files/home/styles.css" type="text/css" rel="stylesheet"/>
    <!--<script src="resources/scripts/jquery-3.2.1.min.js"></script>
    <script src="resources/scripts/axure/axQuery.js"></script>
    <script src="resources/scripts/axure/globals.js"></script>
    <script src="resources/scripts/axutils.js"></script>
    <script src="resources/scripts/axure/annotation.js"></script>
    <script src="resources/scripts/axure/axQuery.std.js"></script>
    <script src="resources/scripts/axure/doc.js"></script>
    <script src="resources/scripts/messagecenter.js"></script>
    <script src="resources/scripts/axure/events.js"></script>
    <script src="resources/scripts/axure/recording.js"></script>
    <script src="resources/scripts/axure/action.js"></script>
    <script src="resources/scripts/axure/expr.js"></script>
    <script src="resources/scripts/axure/geometry.js"></script>
    <script src="resources/scripts/axure/flyout.js"></script>
    <script src="resources/scripts/axure/model.js"></script>
    <script src="resources/scripts/axure/repeater.js"></script>
    <script src="resources/scripts/axure/sto.js"></script>
    <script src="resources/scripts/axure/utils.temp.js"></script>
    <script src="resources/scripts/axure/variables.js"></script>
    <script src="resources/scripts/axure/drag.js"></script>
    <script src="resources/scripts/axure/move.js"></script>
    <script src="resources/scripts/axure/visibility.js"></script>
    <script src="resources/scripts/axure/style.js"></script>
    <script src="resources/scripts/axure/adaptive.js"></script>
    <script src="resources/scripts/axure/tree.js"></script>
    <script src="resources/scripts/axure/init.temp.js"></script>
    <script src="resources/scripts/axure/legacy.js"></script>
    <script src="resources/scripts/axure/viewer.js"></script>
    <script src="resources/scripts/axure/math.js"></script> 
    <script src="resources/scripts/axure/jquery.nicescroll.min.js"></script> -->
    <script src="data/document.js"></script>
    <script src="files/home/data.js"></script>

    <script src="js/Cookie.js"></script>
</head>
<body> 	
	<div id="base" class="" style="display: inline-block;">
      <div id="u0" class="ax_default box_1 selected">
        <div id="u0_div" class="selected"></div>
        <div id="u0_text" class="text " style="display:none; visibility: hidden">
          <p></p>
        </div>
      </div>
      <div id="u1" class="ax_default box_2">
        <div id="u1_div" class=""></div>
        <div id="u1_text" class="text " style="display:none; visibility: hidden">
          <p></p>
        </div>
      </div>
      <div id="u2" class="ax_default icon" onclick="location.href='TestChat.html'">
        <img id="u2_img" class="img " src="images/home/u2.svg"/>
        <div id="u2_text" class="text " style="display:none; visibility: hidden">
          <p></p>
        </div>
      </div>
      <div id="u3" class="ax_default icon" onclick="location.href='Tournament.html'">
        <img id="u3_img" class="img " src="images/home/u3.svg"/>
        <div id="u3_text" class="text " style="display:none; visibility: hidden">
          <p></p>
        </div>
      </div>
      <div id="u4" class="ax_default icon" onclick="location.reload()">
        <img id="u4_img" class="img " src="images/home/u4.svg"/>
        <div id="u4_text" class="text " style="display:none; visibility: hidden">
          <p></p>
        </div>
      </div>
      <div id="u5" class="ax_default icon" onclick="location.reload()">
        <img id="u5_img" class="img " src="images/home/u5.svg"/>
        <div id="u5_text" class="text " style="display:none; visibility: hidden">
          <p></p>
        </div>
      </div>
      <div id="u6" class="ax_default icon" onclick="location.href='page_1.html'">
        <img id="u6_img" class="img " src="images/home/u6.svg"/>
        <div id="u6_text" class="text " style="display:none; visibility: hidden">
          <p></p>
        </div>
      </div>
      <div id="u7" class="ax_default icon">
        <img id="u7_img" class="img " src="images/home/u7.svg"/>
        <div id="u7_text" class="text " style="display:none; visibility: hidden">
          <p></p>
        </div>
      </div>
      <div id="u8" class="ax_default icon" onclick="location.href='Authorization.html'">
        <img id="u8_img" class="img " src="images/home/u8.svg"/>
        <div id="u8_text" class="text " style="display:none; visibility: hidden">
          <p></p>
        </div>
      </div>
      <div id="u9" class="ax_default image">
        <img id="u9_img" class="img " src="images/home/p1.png"/>
        <div id="u9_text" class="text " style="display:none; visibility: hidden">
          <p></p>
        </div>
      </div>
    </div>
	<div style="width: 500px; text-align: center; display: inline-block; margin-left: 500px;">
		<h2>Your Profile</h2>
		<br>
		<div class="card" style="width:400px; display: inline-block; margin-bottom: 40px;">
			<img id="avatar" class="card-img-top" alt="Card image" style="width:100%">
			<div class="card-body">
				<h4 class="card-title" id="login">John Doe</h4>
				<p class="card-text"></p>
				<a href="edit_profile.html" class="btn btn-danger">Edit Profile</a>
			</div>
		</div>
		<br>
		<!--<h4>Elementary</h4>
		<div class="progress">
			<div class="progress-bar" style="width:40%; background-color:#cc0000 !important"></div>
		</div>	
		<h4>Beginner</h4>
		<div class="progress">
			<div class="progress-bar" style="width:30%; background-color:#ff3300 !important"></div>
		</div>
		<hr>
		<h4>Pre-Intermediate</h4>
		<div class="progress">
			<div class="progress-bar" style="width:20%; background-color:#ffff00 !important"></div>
		</div>
		<h4>Intermediate</h4>
		<div class="progress">
			<div class="progress-bar" style="width:10%; background-color:#009900 !important"></div>
		</div>
		<h4>Upper-Intermediate</h4>
		<div class="progress">
			<div class="progress-bar" style="width:7%; background-color:#003399 !important"></div>
		</div>
		<hr>
		<h4>Advanced</h4>
		<div class="progress">
			<div class="progress-bar" style="width:5%; background-color:#ff00ff !important"></div>
		</div>-->
        <span id = "level">Level: </span>
        <br />
        <span id="progress">Progress: </span>
	</div>

    <script>
        function getAvatar(object){
            let req = new XMLHttpRequest();
            req.open("GET", "personal/getAvatar?id=" + object.id, true);

            req.onload = ()=>{
                let response = req.response;
                if(response){
                    document.getElementById("avatar").src = response;
                    object.avatar = response;
                    setCookie("user", JSON.stringify(object));
                }else{
                    document.getElementById("avatar").src = "images/anonymous.jpg";
                }
            };

            req.send();
        }

        window.onload = function(){
            let user = getCookie("user");
            if(user == null){
                location.href = address + "/Authorization.html"
            }
            let object = JSON.parse(user);
            getAvatar(object);

            document.getElementById("level").innerText += object.level;

            let req = new XMLHttpRequest();
            req.open("GET", "http://192.168.0.103:5000/level/get", true);

            req.onload = function(){
                let resp = req.response;
                let ans = JSON.parse(resp);

                let min = 100000000;

                if(object.level == "ELEMENTARY"){
                    min = ans.BEGINNER;
                }else if(object.level ==  "BEGINNER"){
                    min = ans.PREINTERMEDIATE;
                }else if(object.level == "PREINTERMEDIATE"){
                    min = ans.INTERMEDIATE;
                }else if(object.level == "INTERMEDIATE"){
                    min = ans.UPPERINTERMEDIATE;
                }else if(object.level == "UPPERINTERMEDIATE"){
                    min = ans.ADVANCED;
                }else if(object.level == "ADVANCED") {
                    min = ans.MASTER;
                }else{
                    min = "∞";
                }



                document.getElementById("progress").innerText += object.points + "/" + min;
            };

            req.send();


            document.getElementById("login").innerText = object.login;
            /*let array = document.getElementsByClassName("progress-bar");
            let points = [100, 500, 5000, 15000, 30000, 50000];

            for(let i = 0 ; i < array.length; ++i){
                let coef = user.points / points[i];
                if(coef > 1){
                    array[i].style.width = "100%";
                }else{
                    let value = (coef * 100) + "%";
                    array[i].style.width = value;
                    alert(array[i].style.width);
                }
            }*/
        }
    </script>
</body>
</html>