<!DOCTYPE html>
<html>
<head>
	<title>Edit Profile</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
	<link href="resources/css/axure_rp_page.css" type="text/css" rel="stylesheet"/>
    <link href="data/styles.css" type="text/css" rel="stylesheet"/>
    <link href="files/home/styles.css" type="text/css" rel="stylesheet"/>
    <script src="resources/scripts/jquery-3.2.1.min.js"></script>
    <script src="resources/scripts/axure/axQuery.js"></script>
    <script src="resources/scripts/axure/globals.js"></script>
    <script src="resources/scripts/axutils.js"></script>
    <script src="resources/scripts/axure/annotation.js"></script>
    <script src="resources/scripts/axure/axQuery.std.js"></script>
    <script src="resources/scripts/axure/doc.js"></script>
    <script src="resources/scripts/messagecenter.js"></script>
    <script src="resources/scripts/axure/events.js"></script>
    <script src="resources/scripts/axure/recording.js"></script>
    <script src="resources/scripts/axure/action.js"></script>
    <script src="resources/scripts/axure/expr.js"></script>
    <script src="resources/scripts/axure/geometry.js"></script>
    <script src="resources/scripts/axure/flyout.js"></script>
    <script src="resources/scripts/axure/model.js"></script>
    <script src="resources/scripts/axure/repeater.js"></script>
    <script src="resources/scripts/axure/sto.js"></script>
    <script src="resources/scripts/axure/utils.temp.js"></script>
    <script src="resources/scripts/axure/variables.js"></script>
    <script src="resources/scripts/axure/drag.js"></script>
    <script src="resources/scripts/axure/move.js"></script>
    <script src="resources/scripts/axure/visibility.js"></script>
    <script src="resources/scripts/axure/style.js"></script>
    <script src="resources/scripts/axure/adaptive.js"></script>
    <script src="resources/scripts/axure/tree.js"></script>
    <script src="resources/scripts/axure/init.temp.js"></script>
    <script src="resources/scripts/axure/legacy.js"></script>
    <script src="resources/scripts/axure/viewer.js"></script>
    <script src="resources/scripts/axure/math.js"></script> 
    <script src="resources/scripts/axure/jquery.nicescroll.min.js"></script>
    <script src="data/document.js"></script>
    <script src="files/home/data.js"></script>

    <script src="js/Cookie.js"></script>
</head>
<body>
	<div id="base" class="" style="display: inline-block;">
      <div id="u0" class="ax_default box_1 selected">
        <div id="u0_div" class="selected"></div>
        <div id="u0_text" class="text " style="display:none; visibility: hidden">
          <p></p>
        </div>
      </div>
      <div id="u1" class="ax_default box_2">
        <div id="u1_div" class=""></div>
        <div id="u1_text" class="text " style="display:none; visibility: hidden">
          <p></p>
        </div>
      </div>
      <div id="u2" class="ax_default icon">
        <img id="u2_img" class="img " src="images/home/u2.svg"/>
        <div id="u2_text" class="text " style="display:none; visibility: hidden">
          <p></p>
        </div>
      </div>
      <div id="u3" class="ax_default icon">
        <img id="u3_img" class="img " src="images/home/u3.svg"/>
        <div id="u3_text" class="text " style="display:none; visibility: hidden">
          <p></p>
        </div>
      </div>
      <div id="u4" class="ax_default icon">
        <img id="u4_img" class="img " src="images/home/u4.svg"/>
        <div id="u4_text" class="text " style="display:none; visibility: hidden">
          <p></p>
        </div>
      </div>
      <div id="u5" class="ax_default icon">
        <img id="u5_img" class="img " src="images/home/u5.svg"/>
        <div id="u5_text" class="text " style="display:none; visibility: hidden">
          <p></p>
        </div>
      </div>
      <div id="u6" class="ax_default icon">
        <img id="u6_img" class="img " src="images/home/u6.svg"/>
        <div id="u6_text" class="text " style="display:none; visibility: hidden">
          <p></p>
        </div>
      </div>
      <div id="u7" class="ax_default icon">
        <img id="u7_img" class="img " src="images/home/u7.svg"/>
        <div id="u7_text" class="text " style="display:none; visibility: hidden">
          <p></p>
        </div>
      </div>
      <div id="u8" class="ax_default icon">
        <img id="u8_img" class="img " src="images/home/u8.svg"/>
        <div id="u8_text" class="text " style="display:none; visibility: hidden">
          <p></p>
        </div>
      </div>
      <div id="u9" class="ax_default image">
        <img id="u9_img" class="img " src="images/home/p1.png"/>
        <div id="u9_text" class="text " style="display:none; visibility: hidden">
          <p></p>
        </div>
      </div>
    </div>
	<div style="width: 500px; text-align: center; display: inline-block; margin-left: 500px;">
		<h2>Edit Profile</h2>
        <img src="#" id = "avatar" style="max-width: 100%">
        <form method="POST" action="personal/setAvatar" enctype="multipart/form-data">
            <div id = "imageDiv" style="visibility: visible">
                <input type="number" name = "id" id="uid" style="visibility: hidden">
                <input type="file" name = "avatar" width="70">
                <input type="submit">
            </div>
        </form>
        <div>
			<div class="form-group">
				<label for="email">Email address:</label>
				<input type="email" name="email" class="form-control" id="email" />
			</div>
            <div class="form-group">
                <label for="email">Birthday</label>
                <input type="date" name="birthday" class="form-control" id="birthday" />
            </div>
			<button type="submit" class="btn btn-danger" onclick="sendUpdate()">Save changes</button>
		</div>

        <script>

            function sendUpdate(){
                let req = new XMLHttpRequest();

                let login = (JSON.parse(getCookie("user"))).login;
                let email = document.getElementById("email").value;
                let birthday = document.getElementById("birthday").value;

                req.open("post", "http://192.168.0.103:5000/personal/updateProfile?login=" + login +
                    "&email=" + email + "&birthday=" + birthday, true);

                req.onload = ()=>{
                  setCookie("user", req.response);
                };
                req.send();
            }

            let user = getCookie("user");
            if(user == null){
                location.href = address + "/Authorization.html"
            }
            let object = JSON.parse(user);

            document.getElementById("uid").value=object.id;
            document.getElementById("birthday").value=object.birthday;
            document.getElementById("email").value = object.email;


            if(object.avatar){
                document.getElementById("avatar").src = object.avatar;
            }else{
                document.getElementById("avatar").src = "http://192.168.0.103:5000/images/anonymous.jpg";
            }

        </script>
	</div>
</body>
</html>